AT_BANNER([[Checking encode and decode of sample data]])

AT_SETUP([samples])

AT_CHECK([(test $DIRAC_INPUT_DATA_DIR -a -d $DIRAC_INPUT_DATA_DIR) || exit 77], ignore)

for samp in `ls $DIRAC_INPUT_DATA_DIR/*.hdr`;
do

samp=`echo $samp | sed 's/\.hdr//g'`;
encout="$samp"_"enc";
encout=`basename $encout`
decout="$samp"_"dec";
decout=`basename $decout`
instrout="$samp"_"instr";
instrout=`basename $instrout`
is_SD=`echo $samp | egrep "576|576p"`
echo "is_SD=$is_SD"
is_HD720=`echo $samp | egrep "1280|720p"`
echo "is_HD720=$is_HD720"
is_HD1080=`echo $samp | egrep "1920|1080i"`
echo "is_HD1080=$is_HD1080"
if [ test $is_SD ]; then
	preset="-SD576";
elif [ test $is_HD720 ]; then
	preset="-HD720";
elif [ test $is_HD1080  ]; then
	preset="-HD1080";
else
	preset="-CIF";
fi
AT_CHECK([at_wrap dirac_encoder $preset -qf 7 $samp ../../$encout], 0, [ignore])
AT_CHECK([at_wrap dirac_decoder ../../$encout ../../$decout], 0, [ignore])
AT_CHECK([cmp ../../$encout.yuv ../../$decout.yuv]
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_mc_instr -motion_colour -clip 50], 0)
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_ma_instr -motion_arrows -clip 50], 0)
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_mca_instr -motion_colour_arrows -clip 50], 0)
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_spm_instr -split_mode -clip 50], 0)
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_sad_instr -sad -clip 50], 0)
AT_CHECK([at_wrap dirac_instrumentation ../../$encout ../../"$instrout"_pred_instr -pred_mode -clip 50], 0)
)
done
AT_CLEANUP
